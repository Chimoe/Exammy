<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!-- Fix view to device-width -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title> Exammy</title>
    <!-- Bootstrap 4 CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- FontAwesome CSS + Font -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <!-- Underscore.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>

    <!-- jquery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>


</head>

<body>

<script src="js/monitor.js"></script>

<!-- Window change detection -->
<script>
    const OriginTitle = document.title;
    let titleTime;
    document.addEventListener('visibilitychange', function () {
        if (document.hidden) {
            document.title = 'User left ' + OriginTitle;
            clearTimeout(titleTime);
        }
        else {
            document.title = 'Returned ' + OriginTitle;
            titleTime = setTimeout(function () {
                document.title = OriginTitle;
            }, 200000000);
        }
    });
</script>

<!-- Navbar -->
<nav class="navbar text-light" style="background-color: #cca4e3;">
    <h1 style="padding-right: 20px">Exam taking</h1>
    <button type="button" class="btn btn-warning" id = "gamestart" onclick="openFullscreen()" >Start test?</button>
    <button type="button" class="btn btn-warning" id = "Regrade" style.display="none" onclick = "sendre()">Regrade</button>
    <ul class="navbar-nav ml-auto">
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://rcos.io">Rensselaer Center of Open Source</a>
        </li>
    </ul>
</nav>

<!-- main container -->
<main>
    <div class="container fill">
        <div class="d-flex" id="main-body" style="padding-bottom: 20px">
                <!-- Vue.js input binding support -->
                <div id='m-choice' style="padding-top: 20px">
                    <span>Selected: {{ checkedChoice }}</span>
                    <!-- Bootstrap card for containing test questions -->
                    <div class="row" style="padding-top: 20px">

                        <div class='col-sm-6'>

                        <div class="card" style="padding: 5px">
                            <div class="card-header">
                                Paxos algorithm is designed by:<br>
                                A: Leslie Lamport<br>
                                B: Einstein<br>
                                C: Alan Turing<br>
                                D: Steve Jobs<br>
                            </div>
                            <div class="card-body">
                                <input type="checkbox" id="ChoiceA" value="1A" v-model="checkedChoice">
                                <label for="ChoiceA"> A </label>
                                <input type="checkbox" id="ChoiceB" value="1B" v-model="checkedChoice">
                                <label for="ChoiceB"> B </label>
                                <input type="checkbox" id="ChoiceC" value="1C" v-model="checkedChoice">
                                <label for="ChoiceC"> C </label>
                                <input type="checkbox" id="ChoiceD" value="1D" v-model="checkedChoice">
                                <label for="ChoiceC"> D </label>
                                <br>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="card" style="padding: 5px">
                            <div class="card-header">
                                Wuu-Bernstein algorithm make use of:<br>
                                A: physical clock<br>
                                B: Lamport Clock<br>
                            </div>
                            <div class="card-body">
                                <input type="checkbox" id="Choice2A" value="2A" v-model="checkedChoice">
                                <label for="Choice2A"> A </label>
                                <input type="checkbox" id="Choice2B" value="2B" v-model="checkedChoice">
                                <label for="Choice2B"> B </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div>
              <button type="button" class="btn btn-primary" onclick="sendans()">Submit</button>
            </div>
        </div>


        <script src="./js/index.js"></script>
    </div>
</main>

</body>

</html>
<script>
$(document).ready(function(){
  var c = Cookies.get("username");
  if (c){
  }
  else{
    window.location.replace("index.html");
  }
  $.ajax({
    type: "POST",
    url: "http://ec2-35-153-68-95.compute-1.amazonaws.com:9090/courses",
    xhrFields: {withCredentials: true},
    success: function(data,status,xhr){
      console.log("hahahaha");
      var para = document.createElement("p");
      var node = document.createTextNode(xhr.responseText);
      para.appendChild(node);
      var element = document.getElementById("info");
      element.appendChild(para);

      //window.location.replace("student.html");
    },
    error: function(e){
      console.log("nonon");
    }
  });

});
</script>
<script type="text/javascript">
  var elem = document.getElementById("main-body");
  var button = document.getElementById("gamestart")
	//right click disabled
	document.body.oncontextmenu=document.body.ondragstart= 	document.body.onselectstart=document.body.onbeforecopy=function(){return false;};
	//disabled cut
	document.body.oncopy=document.body.oncut=function(){return false;};
	var blurNum=-3;
  var arr = ["A", "B"];
  function openFullscreen() {
    button.style.display = "none";
    if (elem.requestFullscreen) {
      elem.requestFullscreen();
    } else if (elem.mozRequestFullScreen) { /* Firefox */
      elem.mozRequestFullScreen();
    } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
      elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) { /* IE/Edge */
      elem.msRequestFullscreen();
    }
}
  function sendre(){
    alert("Request send!");
  }
  function sendans(){
    if(button.style.display != "none"){
      alert("You did not start!");
    }else{
      document.getElementById("Regrade").style.display = "block";
      $.ajax({
        type: "POST",
        url: "http://ec2-35-153-68-95.compute-1.amazonaws.com:9090/answers",
        data: JSON.stringify({
          "TestID": 1,
          "Answers": arr
        }),
        xhrFields: {withCredentials: true},
        success: function(data,status,xhr){
          console.log("hahahaha");

          //window.location.replace("student.html");
        },
        error: function(e){
          console.log("nonon");
        }
      });
      $.ajax({
        type: "POST",
        url: "http://ec2-35-153-68-95.compute-1.amazonaws.com:9090/grade",
        data: "1",
        xhrFields: {withCredentials: true},
        success: function(data,status,xhr){
          alert("Your grade is : "+ xhr.responseText);

          //window.location.replace("student.html");
        },
        error: function(e){
          alert("Your grade is not yet ready! ");
          console.log("nonon");
        }
      });
      button.style.display = "block" ;
    }
  }
	$(window).on('blur resize',function(){
		if(blurNum>3){
			alert("Test end！");
			$(window).off("beforeunload");
			CloseWebPage();
		}else{
      if (blurNum > 0){
        alert("Warning changed web size "+blurNum+" time(s)！");
      }

		}
		blurNum++;
	});

	$(window).on('beforeunload', function(){
		$(this).off('blur resize');
	    return 'Exit test!';
	});

	//close window
	function CloseWebPage(){
	 if (navigator.userAgent.indexOf("MSIE") > 0) {
	  if (navigator.userAgent.indexOf("MSIE 6.0") > 0) {
	   window.opener = null;
	   window.close();
	  } else {
	   window.open('', '_top');
	   window.top.close();
	  }
	 }
	 else if (navigator.userAgent.indexOf("Firefox") > 0) {
	  window.location.href = 'about:blank ';
	 } else {
	  window.opener = null;
	  window.open('', '_self', '');
	  window.close();
	 }
	}
</script>
